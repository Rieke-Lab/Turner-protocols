classdef Shared2PWithMicrodisplay < edu.washington.riekelab.rigs.Confocal
    
    methods
        
        function obj = Shared2PWithMicrodisplay()
            import symphonyui.builtin.devices.*;
            
            ramps = containers.Map();
            ramps('minimum') = linspace(0, 65535, 256);
            ramps('low')     = obj.MICRODISPLAY_LOW_GAMMA_RAMP * 65535;
            ramps('medium')  = obj.MICRODISPLAY_MEDIUM_GAMMA_RAMP * 65535;
            ramps('high')    = obj.MICRODISPLAY_HIGH_GAMMA_RAMP * 65535;
            ramps('maximum') = linspace(0, 65535, 256);
            microdisplay = edu.washington.riekelab.devices.MicrodisplayDevice(ramps, 'COM1');
            microdisplay.addConfigurationSetting('micronsPerPixel', 3.3, 'isReadOnly', true);
            obj.addDevice(microdisplay);
            
            % Binding the microdisplay to an unused stream only so its configuration settings are written to each epoch.
            daq = obj.daqController;
            microdisplay.bindStream(daq.getStream('DIGITAL_OUT.1'));
            daq.getStream('DIGITAL_OUT.1').setBitPosition(microdisplay, 15);
            
            frameMonitor = UnitConvertingDevice('Frame Monitor', 'V').bindStream(obj.daqController.getStream('ANALOG_IN.7'));
            obj.addDevice(frameMonitor);
        end
        
    end
    
    properties (Constant)
        % This is a useful command to go from ramp array to this...
        % strjoin(arrayfun(@(x) num2str(x),ramp,'UniformOutput',false),';\n')
        
        MICRODISPLAY_LOW_GAMMA_RAMP = [ ...
            0;
            0.25141;
            0.26311;
            0.27111;
            0.27733;
            0.28199;
            0.28576;
            0.28927;
            0.29247;
            0.29546;
            0.29831;
            0.30115;
            0.30386;
            0.30653;
            0.30921;
            0.31182;
            0.31452;
            0.31754;
            0.32185;
            0.32563;
            0.32859;
            0.33138;
            0.33414;
            0.33699;
            0.33984;
            0.34267;
            0.34552;
            0.34858;
            0.35152;
            0.35446;
            0.35746;
            0.36059;
            0.36433;
            0.36807;
            0.37162;
            0.3749;
            0.37809;
            0.38131;
            0.38454;
            0.3876;
            0.39076;
            0.39394;
            0.3971;
            0.40023;
            0.40322;
            0.40625;
            0.40972;
            0.41378;
            0.41779;
            0.42127;
            0.42444;
            0.42766;
            0.43086;
            0.43405;
            0.4372;
            0.44038;
            0.44363;
            0.44684;
            0.45;
            0.45308;
            0.45632;
            0.46;
            0.46391;
            0.46754;
            0.47081;
            0.47402;
            0.47721;
            0.4804;
            0.48352;
            0.48654;
            0.48971;
            0.49283;
            0.49599;
            0.49917;
            0.50235;
            0.50586;
            0.51038;
            0.51479;
            0.51821;
            0.52129;
            0.52445;
            0.52753;
            0.53059;
            0.5337;
            0.53673;
            0.53981;
            0.54287;
            0.54587;
            0.54877;
            0.55196;
            0.5554;
            0.55906;
            0.56249;
            0.56563;
            0.56872;
            0.5717;
            0.57469;
            0.57762;
            0.58047;
            0.58351;
            0.58643;
            0.58927;
            0.59203;
            0.59473;
            0.59761;
            0.6007;
            0.60399;
            0.6071;
            0.61001;
            0.61289;
            0.61583;
            0.61868;
            0.62158;
            0.62452;
            0.62749;
            0.63033;
            0.63319;
            0.63608;
            0.63903;
            0.64224;
            0.64562;
            0.64884;
            0.65185;
            0.65471;
            0.65753;
            0.66032;
            0.66311;
            0.66599;
            0.66878;
            0.67154;
            0.67425;
            0.67692;
            0.67973;
            0.68287;
            0.68679;
            0.69054;
            0.69381;
            0.69667;
            0.69946;
            0.7022;
            0.70483;
            0.7075;
            0.7102;
            0.71297;
            0.71568;
            0.71835;
            0.72098;
            0.72381;
            0.72685;
            0.73011;
            0.73337;
            0.73613;
            0.73879;
            0.74139;
            0.74402;
            0.74673;
            0.74946;
            0.75199;
            0.75457;
            0.75717;
            0.75967;
            0.76225;
            0.76495;
            0.76812;
            0.77129;
            0.77419;
            0.77689;
            0.77949;
            0.78207;
            0.78463;
            0.78721;
            0.78978;
            0.79235;
            0.79494;
            0.79744;
            0.79987;
            0.80255;
            0.8054;
            0.80843;
            0.81145;
            0.81406;
            0.81661;
            0.81913;
            0.82153;
            0.82393;
            0.82641;
            0.82888;
            0.83134;
            0.8339;
            0.8364;
            0.83882;
            0.8417;
            0.845;
            0.84849;
            0.85161;
            0.85415;
            0.85661;
            0.85904;
            0.86143;
            0.86388;
            0.8664;
            0.86877;
            0.87115;
            0.87363;
            0.87606;
            0.87845;
            0.8812;
            0.88406;
            0.88691;
            0.88949;
            0.89191;
            0.89427;
            0.89664;
            0.89901;
            0.90137;
            0.90375;
            0.90612;
            0.90837;
            0.91059;
            0.91277;
            0.91512;
            0.91759;
            0.92045;
            0.92308;
            0.92555;
            0.9279;
            0.93026;
            0.93263;
            0.93494;
            0.93723;
            0.93939;
            0.94159;
            0.94399;
            0.94632;
            0.94858;
            0.95119;
            0.95384;
            0.95644;
            0.95887;
            0.96124;
            0.96351;
            0.96579;
            0.96807;
            0.97029;
            0.97249;
            0.97484;
            0.97713;
            0.97929;
            0.98159;
            0.98405;
            0.98711;
            0.99024;
            0.99312;
            0.99561;
            0.99784;
            1];

        MICRODISPLAY_MEDIUM_GAMMA_RAMP = [ ...
            0.086275;
            0.24709;
            0.25897;
            0.26596;
            0.27113;
            0.27538;
            0.27927;
            0.28273;
            0.28595;
            0.28894;
            0.29172;
            0.29436;
            0.29692;
            0.2996;
            0.30242;
            0.30548;
            0.30835;
            0.311;
            0.31347;
            0.31593;
            0.31837;
            0.32076;
            0.32322;
            0.32571;
            0.32812;
            0.33062;
            0.33322;
            0.33573;
            0.3383;
            0.34096;
            0.34398;
            0.34791;
            0.35214;
            0.35565;
            0.3587;
            0.36159;
            0.36452;
            0.36739;
            0.37029;
            0.37323;
            0.37616;
            0.37917;
            0.38217;
            0.38515;
            0.38814;
            0.391;
            0.39406;
            0.39744;
            0.40112;
            0.40477;
            0.40818;
            0.41121;
            0.41431;
            0.41732;
            0.42027;
            0.4233;
            0.42637;
            0.42945;
            0.43257;
            0.43573;
            0.43869;
            0.44158;
            0.44449;
            0.44755;
            0.45132;
            0.4553;
            0.4591;
            0.46238;
            0.4655;
            0.46852;
            0.47156;
            0.47471;
            0.47765;
            0.48075;
            0.48389;
            0.48698;
            0.49005;
            0.49307;
            0.4961;
            0.4992;
            0.50251;
            0.50626;
            0.51007;
            0.51353;
            0.51662;
            0.51965;
            0.52266;
            0.52566;
            0.52884;
            0.53185;
            0.53485;
            0.53788;
            0.54092;
            0.54388;
            0.54679;
            0.54973;
            0.55288;
            0.55686;
            0.56151;
            0.5655;
            0.56887;
            0.57187;
            0.57492;
            0.57783;
            0.58063;
            0.5837;
            0.58668;
            0.58965;
            0.59264;
            0.59559;
            0.59856;
            0.60146;
            0.60435;
            0.60757;
            0.61097;
            0.61454;
            0.61784;
            0.6209;
            0.62386;
            0.62694;
            0.62987;
            0.63277;
            0.63565;
            0.63844;
            0.64126;
            0.6441;
            0.64692;
            0.64961;
            0.65227;
            0.6549;
            0.65785;
            0.661;
            0.6642;
            0.6673;
            0.67018;
            0.67297;
            0.67578;
            0.67862;
            0.68135;
            0.6842;
            0.68704;
            0.68968;
            0.69255;
            0.6954;
            0.69816;
            0.70093;
            0.70383;
            0.70696;
            0.7104;
            0.71359;
            0.71658;
            0.71944;
            0.72223;
            0.72504;
            0.72771;
            0.73045;
            0.73333;
            0.73589;
            0.7386;
            0.74148;
            0.74409;
            0.74675;
            0.74951;
            0.75272;
            0.75697;
            0.7607;
            0.76389;
            0.76678;
            0.76951;
            0.77215;
            0.77482;
            0.77751;
            0.78023;
            0.78289;
            0.78557;
            0.78827;
            0.79096;
            0.79358;
            0.79616;
            0.79903;
            0.80211;
            0.8053;
            0.80841;
            0.81133;
            0.8139;
            0.81649;
            0.81929;
            0.82192;
            0.82448;
            0.82697;
            0.82955;
            0.83219;
            0.83491;
            0.83742;
            0.83992;
            0.8425;
            0.84528;
            0.84833;
            0.85162;
            0.85465;
            0.8573;
            0.8599;
            0.86248;
            0.86509;
            0.86762;
            0.87005;
            0.87264;
            0.87527;
            0.87788;
            0.88041;
            0.88292;
            0.88543;
            0.8881;
            0.8909;
            0.89392;
            0.89692;
            0.89969;
            0.90232;
            0.90501;
            0.90756;
            0.91004;
            0.91248;
            0.91491;
            0.91735;
            0.91978;
            0.92225;
            0.92482;
            0.92726;
            0.92968;
            0.93255;
            0.93586;
            0.9392;
            0.94226;
            0.94503;
            0.94754;
            0.95005;
            0.95257;
            0.95493;
            0.95728;
            0.95973;
            0.96222;
            0.96473;
            0.96715;
            0.96953;
            0.97187;
            0.97439;
            0.97705;
            0.97996;
            0.98281;
            0.98545;
            0.98786;
            0.99038;
            0.99286;
            0.99518;
            0.99757;
            1];
        
        MICRODISPLAY_HIGH_GAMMA_RAMP = [ ...
            0.035294;
            0.23903;
            0.25172;
            0.25893;
            0.26381;
            0.26794;
            0.27148;
            0.27466;
            0.27755;
            0.28024;
            0.28292;
            0.28592;
            0.28846;
            0.29083;
            0.29297;
            0.29508;
            0.29717;
            0.2992;
            0.30119;
            0.30315;
            0.30509;
            0.30714;
            0.30925;
            0.31214;
            0.31488;
            0.31719;
            0.31925;
            0.32125;
            0.32332;
            0.3254;
            0.3275;
            0.32962;
            0.33184;
            0.33408;
            0.33639;
            0.33905;
            0.34182;
            0.3443;
            0.34675;
            0.34918;
            0.35157;
            0.35402;
            0.35654;
            0.35902;
            0.36152;
            0.36405;
            0.36665;
            0.36945;
            0.3728;
            0.37594;
            0.37871;
            0.38137;
            0.384;
            0.38669;
            0.3894;
            0.39213;
            0.3949;
            0.3976;
            0.40028;
            0.40335;
            0.40669;
            0.40986;
            0.41282;
            0.41564;
            0.41845;
            0.42123;
            0.42401;
            0.42688;
            0.42974;
            0.43257;
            0.43538;
            0.4385;
            0.44261;
            0.44663;
            0.44982;
            0.45273;
            0.45553;
            0.4584;
            0.4613;
            0.46424;
            0.46719;
            0.46995;
            0.47291;
            0.47601;
            0.47931;
            0.48281;
            0.486;
            0.48901;
            0.492;
            0.49496;
            0.49788;
            0.50088;
            0.50388;
            0.50678;
            0.50947;
            0.51224;
            0.51522;
            0.51843;
            0.52164;
            0.52462;
            0.52764;
            0.53063;
            0.53354;
            0.53647;
            0.53942;
            0.54238;
            0.54531;
            0.54807;
            0.55134;
            0.5549;
            0.55829;
            0.56141;
            0.56437;
            0.56734;
            0.57027;
            0.57319;
            0.57612;
            0.57908;
            0.58199;
            0.58488;
            0.58788;
            0.59225;
            0.59644;
            0.59968;
            0.60263;
            0.60551;
            0.60838;
            0.61126;
            0.61432;
            0.61731;
            0.62018;
            0.62293;
            0.62612;
            0.62957;
            0.63307;
            0.63636;
            0.63935;
            0.64221;
            0.6451;
            0.64796;
            0.65073;
            0.65374;
            0.65669;
            0.65956;
            0.66236;
            0.66568;
            0.66923;
            0.67251;
            0.67552;
            0.6784;
            0.68134;
            0.68425;
            0.68711;
            0.68988;
            0.69287;
            0.69576;
            0.69863;
            0.70173;
            0.70511;
            0.70842;
            0.7115;
            0.71443;
            0.71738;
            0.72021;
            0.72306;
            0.72593;
            0.72874;
            0.73163;
            0.73453;
            0.73749;
            0.74146;
            0.74539;
            0.74865;
            0.75152;
            0.75432;
            0.75713;
            0.7599;
            0.76278;
            0.76566;
            0.76844;
            0.77131;
            0.77431;
            0.77755;
            0.78103;
            0.78421;
            0.78709;
            0.78993;
            0.79274;
            0.79557;
            0.79827;
            0.80099;
            0.8038;
            0.80633;
            0.80895;
            0.81173;
            0.81505;
            0.81821;
            0.82114;
            0.82395;
            0.82688;
            0.82967;
            0.83242;
            0.83515;
            0.83794;
            0.84067;
            0.84337;
            0.84643;
            0.84978;
            0.85296;
            0.85593;
            0.85878;
            0.86159;
            0.86437;
            0.86711;
            0.86978;
            0.87255;
            0.87532;
            0.87799;
            0.8811;
            0.88493;
            0.88858;
            0.8917;
            0.89457;
            0.8973;
            0.90001;
            0.90274;
            0.90551;
            0.90825;
            0.91098;
            0.91371;
            0.91664;
            0.91968;
            0.92278;
            0.92584;
            0.92861;
            0.93142;
            0.93419;
            0.93684;
            0.93937;
            0.94195;
            0.94471;
            0.95391;
            0.95586;
            0.95313;
            0.96654;
            0.96998;
            0.97336;
            0.9766;
            0.98029;
            0.98345;
            0.98602;
            0.98843;
            0.99163;
            0.99454;
            0.99732;
            1];
        
    end
    
end

